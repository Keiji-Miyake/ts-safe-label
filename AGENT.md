# 🚀 ts-safe-label 開発指示書

## プロジェクト概要

TypeScriptの`enum`または`Union Type`定義から、UIで使用するための**型安全な選択肢リスト（`value`/`label`形式）**を生成するユーティリティライブラリ。

開発者はキーの存在を気にすることなく、UI側で利用できる型安全な選択肢リストをすぐに取得できる。

## 目的

- UIコンポーネント（select、radio、checkboxなど）で使用する選択肢リストの生成を自動化
- TypeScriptの型システムを活用し、コンパイル時にキーの存在チェックを実現
- 存在しないキーを渡そうとした場合、TypeScriptがコンパイルエラーを出力
- 型安全性を保ちながら、開発体験を向上

## 開発環境

| 項目 | 技術選定 | 理由 |
|------|----------|------|
| **言語** | TypeScript (Strict Mode) | 完全な型安全性を実現 |
| **パッケージマネージャー** | npm / yarn / pnpm | 任意 |
| **テストフレームワーク** | Vitest | 高速で現代的なテスト体験 |
| **リンター/フォーマッター** | Biome | ESLintより高速、設定も簡単 |
| **ビルドツール** | tsup | 簡単にCJS/ESM/型定義を生成 |

## 必須機能要件

### 1. `createLabelList` 関数（メイン機能）

#### 入力
- 元となる`enum`または`Union Type`を表現するオブジェクト
  - 例：`{ RED: 'red', BLUE: 'blue' }`
- ラベルの変換を行う関数またはマッピングオブジェクト
  - 例：`{ RED: '赤', BLUE: '青' }`

#### 出力
- `Array<{ value: TValue, label: string }>` 形式の配列

#### 型安全性
- `value`フィールドは、元の`enum`のキーまたは値の**Union Type**で厳密に型付け
- ユーザーが用意したラベル変換オブジェクトが存在しないキーを渡そうとした場合、TypeScriptがコンパイル時にエラーを出力
- 部分的なラベルマップも許容（`Partial<LabelMap<TEnum>>`）

### 2. キーと値の扱い（基本設計）

#### デフォルト動作
- `enum`の**キー（`'RED'`）を`value`**として扱う
- 出力例：`[{ value: 'RED', label: '赤' }, ...]`

#### オプション動作
- `useEnumValues: true` オプションで、`enum`の**値（`'red'`）を`value`**として扱える
- 出力例：`[{ value: 'red', label: '赤' }, ...]`

### 3. 型定義のエクスポート

以下の型をエクスポートし、ユーザーが外部で型を再利用できるようにする：

- `SafeLabel<TValue>` - 生成されるリストの型
- `LabelMap<TEnum>` - 完全なラベルマップの型
- `PartialLabelMap<TEnum>` - 部分的なラベルマップの型
- `KeysOf<T>` - オブジェクトのキーを抽出する型
- `ValuesOf<T>` - オブジェクトの値を抽出する型
- `CreateLabelListOptions` - オプションの型

## 開発プロセス（TDD推奨）

### Step 1: 初期設定とテストファイル作成

#### 必要なパッケージのインストール
```bash
npm install -D typescript vitest @biomejs/biome tsup
```

#### 設定ファイルの作成
- `package.json` - スクリプトとメタデータ
- `tsconfig.json` - TypeScript Strict Mode設定
- `vitest.config.ts` - Vitestの設定
- `biome.json` - Biomeのリント・フォーマット設定

### Step 2: 主要な型定義とテストの記述（優先）

#### 型定義の作成
1. `Union Type`を表現するオブジェクトから、そのキーのUnion Typeを抽出するユーティリティ型を定義
2. `createLabelList`の基本的なシグネチャ（関数定義）を作成
3. 関数オーバーロードで、`useEnumValues`オプションによる戻り値の型を適切に変更

#### テストケースの作成
- **厳密な型チェックが機能しているか**を確認する最初のテストケース
- 完全なラベルマップを提供した場合のテスト
- 部分的なラベルマップを提供した場合のテスト
- ラベルマップを省略した場合のテスト
- `useEnumValues: true` を使用した場合のテスト
- 数値enumでの動作テスト
- エッジケース（空のオブジェクト、単一キーなど）

### Step 3: 関数の実装とリファクタリング

#### 実装のポイント
- Step 2のテストをパスするように`createLabelList`を実装
- `Object.keys()`を使用してenumのキーを取得
- オプションに応じてキーまたは値を`value`として使用
- ラベルが提供されていない場合はキー名をラベルとして使用（デフォルト動作）

#### エラーハンドリング
- ラベル変換関数が提供されない場合のデフォルト動作
  - キーをそのままラベルにする
- 空のオブジェクトの場合は空の配列を返す

### Step 4: ドキュメントと使用例の作成

#### README.md
- ライブラリの目的と特徴
- インストール方法
- 基本的な使い方（複数のパターン）
- API仕様
- Reactなどでの使用例

#### examples/usage.ts
- 実際に動作する使用例のコレクション
- 様々なユースケースのデモ

## 設計思想

### 型安全性の重視
- TypeScriptの型システムを最大限活用
- コンパイル時のエラー検出
- IDEの自動補完サポート

### 開発者体験の向上
- シンプルで直感的なAPI
- 柔軟なオプション設計
- 充実したドキュメント

### テスト駆動開発
- テストファーストで品質を担保
- 包括的なテストカバレッジ
- リファクタリングの安全性確保

## 期待される成果物

### コア機能
✅ `createLabelList` 関数の実装  
✅ 完全な型定義とエクスポート  
✅ 関数オーバーロードによる柔軟な型推論  

### テスト
✅ 13個のテストケース、すべてパス  
✅ 型チェックの検証  
✅ エッジケースのカバレッジ  

### ドキュメント
✅ 詳細なREADME  
✅ 実行可能な使用例  
✅ JSDocコメント  

### ビルド
✅ CommonJS/ESM対応  
✅ 型定義ファイル（.d.ts）生成  
✅ パッケージとして公開可能な形式  

## 実装結果の確認

### テスト実行
```bash
npm test
```

### 型チェック
```bash
npm run typecheck
```

### ビルド
```bash
npm run build
```

### リント・フォーマット
```bash
npm run check
```

すべてが成功すれば、プロジェクトは完成です！

---

**このドキュメントは、AI（GitHub Copilot）に対する開発指示として作成されました。**
**型安全性を重視し、テスト駆動で開発を進めることで、堅牢で実用的なライブラリが短時間で実現できました。**
